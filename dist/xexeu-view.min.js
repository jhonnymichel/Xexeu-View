!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Xexeu=t()}(this,function(){"use strict";function e(e){return null!==e&&"object"===(void 0===e?"undefined":u(e))}function t(e,t){return e.startsWith(t)&&e.endsWith(t)}function n(e){return(e.match(/\[/g)||[]).length===(e.match(/\]/g)||[]).length}function i(e,t){if(!t.match(/\./))return t;var n=e;return t.split(".").forEach(function(e){if(!n[e])throw new Error("Binding Error: Could not find property "+e+" in "+n);n=n[e]}),n}function r(e,t){for(;e.match(/\./);){var n=e.lastIndexOf("."),i=e.substring(0,n);t.push(i),e=i}}function o(e){if(!e.match(/\[|\]/))return e;var t=e.substring(e.lastIndexOf("["),e.length),n=t.indexOf("]");return t=t.substring(0,-1!==n?n:t.length)}function s(e,s){if(!n(e))throw new SyntaxError("Invalid binding expression");for(var u=[],a=e;a.match(/\[|\]/);){var h=o(a);if(h=h.replace(/\[|\]/g,""),t(h,"'")||t(h,'"')){var c=h.substring(0,1);if(!s[h]){h=h.substring(1,h.length-1),a=a.replace("["+c+h+c+"]","."+h);continue}}if(u.push(h),h.match(/\./)){r(h,u);a.substring(0,a.indexOf("["));try{a=a.replace(/\[(.*?)\]/,"."+i(s,h))}catch(e){}}a=a.replace("["+h+"]","."+s[h])}return r(a,u),{stringBinding:e,computedBinding:a,dependencies:u}}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,r){var u={key:e,arg:t,resolve:n,reject:r,next:null};s?s=s.next=u:(o=s=u,i(e,t))})}function i(n,o){try{var s=t[n](o),u=s.value;u instanceof e?Promise.resolve(u.value).then(function(e){i("next",e)},function(e){i("throw",e)}):r(s.done?"return":"normal",s.value)}catch(e){r("throw",e)}}function r(e,t){switch(e){case"return":o.resolve({value:t,done:!0});break;case"throw":o.reject(t);break;default:o.resolve({value:t,done:!1})}(o=o.next)?i(o.key,o.arg):s=null}var o,s;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),h=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},d=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},f=new(function(){function e(){a(this,e)}return h(e,[{key:"registerDirective",value:function(e,t){v.isPrototypeOf(t)?this[e]=t:this[e]=function(e){function n(){return a(this,n),l(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return c(n,e),h(n,[{key:"$modelChanged",value:function(e){t(e,this.node)}}]),n}(v)}},{key:"getDirective",value:function(e){return this[e]}}]),e}()),v=function(){function e(t,n,i){a(this,e),this.node=n,this._hooks=t,this._xexeuCallbacks=i.$_callbacks,this._xexeuViewModel=i.$viewModel,this._hookChanged=this._hookChanged.bind(this),this._hasSkipedFirstBinding=!1,this.$modelChanged&&(this.$modelChanged=this.$modelChanged.bind(this)),this._initializeHooks(),this.$created&&this.$created(n)}return h(e,[{key:"_initializeHooks",value:function(){var e=this;this._hooks.dependencies.forEach(function(t){e._xexeuCallbacks[t]||(e._xexeuCallbacks[t]=[]),e._xexeuCallbacks[t].includes(e._hookChanged)||e._xexeuCallbacks[t].push(e._hookChanged)}),this._xexeuCallbacks[this._hooks.computedBinding]||(this._xexeuCallbacks[this._hooks.computedBinding]=[]),this.$modelChanged&&!this._xexeuCallbacks[this._hooks.computedBinding].includes(this.$modelChanged)&&this._xexeuCallbacks[this._hooks.computedBinding].push(this.$modelChanged),"function"==typeof this.model&&(this.triggerHook=this.model)}},{key:"_hookChanged",value:function(){this._hasSkipedFirstBinding?(this._hooks=s(this._hooks.stringBinding,this._xexeuViewModel),this._initializeHooks(),this.$modelChanged&&this.$modelChanged(this.model)):this._hasSkipedFirstBinding=!0}},{key:"model",get:function(){try{return i(this._xexeuViewModel,this._hooks.computedBinding)}catch(e){return""}},set:function(e){try{var t=this._hooks.computedBinding.split("."),n=this._xexeuViewModel;t.forEach(function(e){"object"===u(n[e])&&(n=n[e])}),n[t[t.length-1]]=e}catch(e){return}}}]),e}();f.registerDirective("xexeu-bind",function(e,t){t.innerText=e});var p=function(e){function t(){return a(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),h(t,[{key:"$created",value:function(e){e.addEventListener("change",this.onInputChanged.bind(this)),e.addEventListener("input",this.onInputChanged.bind(this))}},{key:"$modelChanged",value:function(e){this.node.value=e,this.node.checked=e}},{key:"onInputChanged",value:function(e){this.model="text"!==e.target.type?e.target.checked:e.target.value}}]),t}(v);f.registerDirective("xexeu-model",p);var y=function(e){function t(){return a(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),h(t,[{key:"$created",value:function(e){e.addEventListener("input",this.triggerHook)}}]),t}(v);return f.registerDirective("xexeu-change",y),function(){function t(e){var n=e.node,i=e.viewModel,r=e.methods;a(this,t),this._viewNode=document.querySelector(n),this.$_callbacks={},this.$_domObservers=[],this.$viewModel=this._getObservableProperties(JSON.parse(JSON.stringify(i))),this._originalViewModel=i,this._bindMethodsToViewModel(r),this._setupDirectives(this._parseDirectivesFromViewNode()),this._renderInitialView(i)}return h(t,[{key:"_bindMethodsToViewModel",value:function(e){for(var t in e)this.$viewModel[t]=e[t].bind(this.$viewModel)}},{key:"_renderInitialView",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$viewModel;for(var i in t)e(t[i])?this._renderInitialView(t[i],n[i]):n[i]=t[i]}},{key:"_parseDirectivesFromViewNode",value:function(){return[].concat(d(this._viewNode.querySelectorAll("*"))).filter(function(e){return[].concat(d(e.attributes)).some(function(e){return e.nodeName.startsWith("xexeu-")})})}},{key:"_getObservableProperties",value:function(t,n){var i=this,r=this.$_callbacks,o={},s={};for(var u in t)!function(u){var a=n?n+"."+u:u;e(t[u])&&(o[u]=i._getObservableProperties(t[u],a)),Object.defineProperty(s,u,{get:function(){return this["_"+u]},set:function(e){this["_"+u]=e,r[a]&&r[a].forEach(function(t){return t(e,a)})}})}(u);for(var a in o)s[a]=o[a];return s}},{key:"_setupDirectives",value:function(e){e.forEach(this._setupObserverListForNode.bind(this));var t=!0,n=!1,i=void 0;try{for(var r,o=this.$_domObservers[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var u=r.value;for(var a in u){var h=f.getDirective(a);h&&new h(s(u[a],this._originalViewModel),u.domNode,this)}}}catch(e){n=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw i}}}},{key:"_setupObserverListForNode",value:function(e){var t=this.$_domObservers[this.$_domObservers.push({})-1];t.domNode=e,[].concat(d(e.attributes)).filter(function(e){return e.nodeName.startsWith("xexeu-")}).forEach(function(e){t[e.nodeName]=e.value})}}]),t}()});
