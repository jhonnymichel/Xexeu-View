!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Xexeu=t()}(this,function(){"use strict";function e(e){return null!==e&&"object"===(void 0===e?"undefined":t(e))}var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,o){var s={key:e,arg:t,resolve:n,reject:o,next:null};u?u=u.next=s:(i=u=s,r(e,t))})}function r(n,i){try{var u=t[n](i),s=u.value;s instanceof e?Promise.resolve(s.value).then(function(e){r("next",e)},function(e){r("throw",e)}):o(u.done?"return":"normal",u.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}(i=i.next)?r(i.key,i.arg):u=null}var i,u;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},u=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},s=new(function(){function e(){n(this,e)}return r(e,[{key:"registerDirective",value:function(e,t){a.isPrototypeOf(t)?this[e]=t:this[e]=function(e){function u(){return n(this,u),i(this,(u.__proto__||Object.getPrototypeOf(u)).apply(this,arguments))}return o(u,e),r(u,[{key:"$modelChanged",value:function(e){t(e,this.node)}}]),u}(a)}},{key:"getDirective",value:function(e){return this[e]}}]),e}()),a=function(){function e(t,r,o){n(this,e),this.node=r,this._hook=t,this._xexeuCallbacks=o.$_callbacks,this._xexeuViewModel=o.$viewModel,this._xexeuCallbacks[t]||(this._xexeuCallbacks[t]=[]),this.$modelChanged&&this._xexeuCallbacks[t].push(this.$modelChanged.bind(this)),"function"==typeof this._xexeuViewModel[t]&&(this.triggerHook=this._xexeuViewModel[t]),this.$created&&this.$created(r)}return r(e,[{key:"model",get:function(){var e=this._hook.split("."),t=this._xexeuViewModel;return e.forEach(function(e){return t=t[e]}),t},set:function(e){var n=this._hook.split("."),r=this._xexeuViewModel;n.forEach(function(e){"object"===t(r[e])&&(r=r[e])}),r[n[n.length-1]]=e}}]),e}();s.registerDirective("xexeu-bind",function(e,t){t.innerText=e});var c=function(e){function t(){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),r(t,[{key:"$created",value:function(e){e.addEventListener("change",this.onInputChanged.bind(this)),e.addEventListener("input",this.onInputChanged.bind(this))}},{key:"$modelChanged",value:function(e){this.node.value=e,this.node.checked=e}},{key:"onInputChanged",value:function(e){this.model="text"!==e.target.type?e.target.checked:e.target.value}}]),t}(a);s.registerDirective("xexeu-model",c);var f=function(e){function t(){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),r(t,[{key:"$created",value:function(e){e.addEventListener("input",this.triggerHook)}}]),t}(a);return s.registerDirective("xexeu-change",f),function(){function t(e){var r=e.node,o=e.viewModel,i=e.methods;n(this,t),this._viewNode=document.querySelector(r),this.$_callbacks={},this.$_domObservers=[],this.$viewModel=this._getObservableProperties(JSON.parse(JSON.stringify(o))),this._bindMethodsToViewModel(i),this._setupDirectives(this._parseDirectivesFromViewNode()),this._renderInitialView(o)}return r(t,[{key:"_bindMethodsToViewModel",value:function(e){for(var t in e)this.$viewModel[t]=e[t].bind(this.$viewModel)}},{key:"_renderInitialView",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$viewModel;for(var r in t)e(t[r])?this._renderInitialView(t[r],n[r]):n[r]=t[r]}},{key:"_parseDirectivesFromViewNode",value:function(){return[].concat(u(this._viewNode.querySelectorAll("*"))).filter(function(e){return[].concat(u(e.attributes)).some(function(e){return e.nodeName.startsWith("xexeu-")})})}},{key:"_getObservableProperties",value:function(t,n){var r=this,o=this.$_callbacks,i={},u={};for(var s in t)!function(s){var a=n?n+"."+s:s;e(t[s])&&(i[s]=r._getObservableProperties(t[s],a)),Object.defineProperty(u,s,{get:function(){return this["_"+s]},set:function(e){o[a]&&o[a].forEach(function(t){return t(e)}),this["_"+s]=e}})}(s);for(var a in i)u[a]=i[a];return u}},{key:"_setupDirectives",value:function(e){e.forEach(this._setupObserverListForNode.bind(this));var t=!0,n=!1,r=void 0;try{for(var o,i=this.$_domObservers[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var u=o.value;for(var a in u){var c=s.getDirective(a);c&&new c(u[a],u.domNode,this)}}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}}},{key:"_setupObserverListForNode",value:function(e){var t=this.$_domObservers[this.$_domObservers.push({})-1];t.domNode=e,[].concat(u(e.attributes)).filter(function(e){return e.nodeName.startsWith("xexeu-")}).forEach(function(e){t[e.nodeName]=e.value})}}]),t}()});
