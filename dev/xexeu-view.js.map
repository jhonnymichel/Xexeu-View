{"version":3,"file":"xexeu-view.js","sources":["../src/directives/directive-registry.js","../src/utils.js","../src/directives/directives.js","../src/core.js"],"sourcesContent":["class _DirectiveRegistry {\n  registerDirective(name, initializer) {\n    if (!Directive.isPrototypeOf(initializer)) {\n      this[name] = class extends Directive {\n        $modelChanged(model){\n          initializer(model, this.node);\n        }\n      };\n    } else {\n      this[name] = initializer;\n    }\n  }\n\n  getDirective(name) {\n    return this[name];\n  }\n}\n\nexport const DirectiveRegistry = new _DirectiveRegistry() \n\nexport class Directive {\n  constructor(hook, node, xexeu) {\n    this.node = node;\n    this._hook = hook;\n    this._xexeuCallbacks = xexeu.$_callbacks;\n    this._xexeuViewModel = xexeu.$viewModel;\n\n    if (!this._xexeuCallbacks[hook]) {\n      this._xexeuCallbacks[hook] = [];\n    }\n    if (this.$modelChanged) {\n      this._xexeuCallbacks[hook].push(this.$modelChanged.bind(this));\n    }\n    if (typeof this._xexeuViewModel[hook] === 'function') {\n      this.triggerHook = this._xexeuViewModel[hook];\n    }\n\n    if (this.$created) {\n      this.$created(node);\n    }\n  }\n\n  get model() {\n    const splitted = this._hook.split('.');\n    let property = this._xexeuViewModel;\n    splitted.forEach((i) => property = property[i]);\n    return property;\n  }\n\n  set model(value) {\n    const splitted = this._hook.split('.');\n    let property = this._xexeuViewModel;\n\n    splitted.forEach((i) => {\n      if (typeof property[i] === 'object') {\n        property = property[i]\n      }\n    });\n    property[splitted[splitted.length-1]] = value;\n  }\n}\n","export function isObject (obj) {\n  return (obj !== null && typeof obj === 'object');\n}\n","import { DirectiveRegistry, Directive } from './directive-registry'\n\nDirectiveRegistry.registerDirective('xexeu-bind', (model, node) => {\n  node.innerText = model;\n});\n\nclass XexeuModel extends Directive {\n  $created(node) {\n    node.addEventListener('change', this.onInputChanged.bind(this));\n    node.addEventListener('input', this.onInputChanged.bind(this));\n  }\n\n  $modelChanged(model) {\n    this.node.value = model;\n    this.node.checked = model;\n  }\n\n  onInputChanged(e) {\n    this.model = (e.target.type !== 'text' ? e.target.checked : e.target.value);\n  }\n}\n\nDirectiveRegistry.registerDirective('xexeu-model', XexeuModel);\n\nclass XexeuChange extends Directive {\n  $created(node) {\n    node.addEventListener('input', this.triggerHook);\n  }\n}\n\nDirectiveRegistry.registerDirective('xexeu-change', XexeuChange);\n","import { DirectiveRegistry } from './directives/directive-registry'\nimport { isObject } from './utils'\nimport './directives/directives'\n\nexport default class Xexeu {\n  constructor( {node, viewModel, methods} ) {\n    this._viewNode = document.querySelector(node);\n    this.$_callbacks = {};\n    this.$_domObservers = [];\n    this.$viewModel =\n      this._getObservableProperties(JSON.parse(JSON.stringify(viewModel)));\n    this._bindMethodsToViewModel(methods);\n    this._setupDirectives(this._parseDirectivesFromViewNode());\n    this._renderInitialView(viewModel);\n  }\n\n  _bindMethodsToViewModel(methods) {\n    for (let method in methods) {\n      this.$viewModel[method] = methods[method].bind(this.$viewModel);\n    }\n  }\n\n  _renderInitialView(viewModel, parent=this.$viewModel) {\n    for (let prop in viewModel) {\n      if (isObject(viewModel[prop])) {\n        this._renderInitialView(viewModel[prop], parent[prop]);\n        continue;\n      }\n      parent[prop] = viewModel[prop];\n    }\n  }\n\n  _parseDirectivesFromViewNode() {\n    return [...this._viewNode.querySelectorAll('*')]\n      .filter(\n\t      el => [...el.attributes].some(attr => attr.nodeName.startsWith('xexeu-'))\n      );\n  }\n\n  _getObservableProperties(viewModel, callbackPrep) {\n    let callbackList = this.$_callbacks;\n    let nestedObjects = {};\n    const _viewModel = {};\n    for (let property in viewModel) {\n      let _callbackPrep = callbackPrep ? callbackPrep + '.' + property : property;\n\n      if (isObject(viewModel[property])) {\n\t      nestedObjects[property] = this._getObservableProperties(viewModel[property], _callbackPrep);\n      }\n\n      Object.defineProperty(_viewModel, property, {\n        get() {\n          return this[`_${property}`];\n        },\n        set(value) {\n          if (callbackList[_callbackPrep]) {\n            callbackList[_callbackPrep].forEach(callback => callback(value));\n          }\n          this[`_${property}`] = value;\n        }\n      });\n    }\n\n    for (let nestedObject in nestedObjects) {\n      _viewModel[nestedObject] = nestedObjects[nestedObject];\n    }\n    return _viewModel;\n  }\n\n  _setupDirectives(directives) {\n    directives.forEach(this._setupObserverListForNode.bind(this));\n    for (let item of this.$_domObservers) {\n      for (let xexeuBind in item) {\n        const directive = DirectiveRegistry.getDirective(xexeuBind);\n        if (directive) {\n          new directive(item[xexeuBind], item.domNode, this);\n        }\n      }\n    }\n  }\n\n  _setupObserverListForNode(node) {\n    const domObserver = this.$_domObservers[this.$_domObservers.push({}) - 1];\n    domObserver.domNode = node;\n    [...node.attributes]\n      .filter(attr => attr.nodeName.startsWith('xexeu-'))\n      .forEach(attr => {\n\t      domObserver[attr.nodeName] = attr.value;\n      }\n    );\n  }\n}\n"],"names":["Xexeu"],"mappings":"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"}